В данном курсе мы расскажем, как разработать робота на ROS2 с ESP32 Raspberry Pi 5

I модуль - сборка робота
1. Подготовка материалов и инструментов
Необходимые инструменты:
Лазерный резак/лобзик – для резки фанеры.
Дрель и сверла (2–3) – для отверстий.  
Набор отверток с разными насадками 
Паяльник (40 Вт) + припой (POS-60) – для электроники.  
Мультиметр – проверка цепей.  
Наждачка – обработка краёв

Материалы и комплектующие:  
Компонент
Кол-во
Примечание
Фанера 6 мм
1 лист
600 х 600
Винты М3
33
30х20 мм, 3х50мм
Гайки М3
21
3 из них для закрепления OMNI колеса
Винты М2
4
10мм. Для закрепления шилда с ESP
Гайки М2
4
Стопорные винты
2
Муфта для моторов
2
М5

Название
Назначение/описание
Ссылка
Кол-во 
Цена 
Raspberry pi 5 8gb
«Верхний уровень». Обрабатывает информацию, поступающую с ESP (“нижнего уровня»). Поддержка новейших интерфейсов. Отлично подходит к задачам компьютерного зрения, обработки трёхмерных данных с лидаров. 
https://sl.aliexpress.ru/p?key=0vxkGbg
1
9249
ESP32-WROOM-32
«Нижний уровень». Собирает информацию с датчиков, энкодеров и отправляет на «верхний уровень». Подходит для сетевого проекта из-за встроенных Wi-Fi и Bluetooth. Плюсы: Высокая производительность, Wi-Fi/BT на борту, большой объём памяти, 3,3 В логика.
Минусы: Нужно продуманное питание 3,3 В, сложнее освоить низкоуровневые функции, GPIO имеют ограничения.
https://sl.aliexpress.ru/p?key=7oxkGZr
1
336
JGA25-370 77 RPM 12 B
Необходимы для передвижения робота. Используем 12В для упрощения питания.
https://aliexpress.ru/item/1005007793208347.html?sku_id=12000042220805718&spm=a2g2x.productlist.search_results.1.2ccd33e3p7kOox
2
2 x 610 руб
Драйвер моторов L298N
Позволяет обеспечить требуемую мощность и стабильность, достичь высокой энергоэффективности, надёжности и удобства интеграции в систему. Преимущества: доступность, использование 5В выхода для питания микроконтроллера, питание моторов до 30В, управление 2  DC моторами.
Недостатки: низкий КПД, сильный нагрев, нужно ставить радиатор.
https://aliexpress.ru/item/1005007125159518.html?sku_id=12000042919988210&srcSns=sns_More&businessType=ProductDetail&spreadType=socialShare&tt=MG&utm_medium=sharing 
1
154 руб
Понижающие DC-DC преобразователи Readytosky FPV RC UBEC 5V 5A (
Обеспечивает стабильное питание для микроконтроллера, микрокомпьютера, датчиков и драйверов.
https://aliexpress.ru/item/33019505937.html?sku_id=67198302173&srcSns=sns_More&businessType=ProductDetail&spreadType=socialShare&tt=MG&utm_medium=sharing
2
2 x 410
Литиевые батареи JOUYM 18650, 2000 мАч
Обеспечивает питание робота. Преимущества: Высокая плотность энергии при относительно небольшом размере.
Удобство конфигурации: можно последовательно или параллельно соединять несколько штук, добиваясь нужного напряжения и ёмкости.
https://sl.aliexpress.ru/p?key=ajxkGkw
3
3 х 154
Блок питания с 3 узлами

Лидар SLAMTEC RPLIDAR C1
«Глаза» робота, который смотрит на окружение, вычисляет расстояние, определяет препятствия впереди
https://sl.aliexpress.ru/p?key=fmxkGwR
1
7174
Манипулятор

Штыревые штекеры и гнезда
Для шилда
https://aliexpress.ru/item/1005004954771161.html?spm=a2g2x.detail.rcmdprod.7.6d172dc9ZId1M8&mixer_rcmd_bucket_id=UnknownMixerAbId&pdp_trigger_item_id=0_1005005576560025&ru_algo_pv_id=f712b2-61b690-22faee-72e977-1743876000&scenario=aerSimilarItemPdpRcmd&sku_id=12000031142220245&traffic_source=recommendation&type_rcmd=core
2 х 2
200
Комплект разъемов

2. Изготовление корпуса

Шаг 1: Резка деталей
Загрузите DXF-файлы в станок лазерной резки.  
Основные детали:  
Основание (нижняя платформа)
Средняя платформа
Крышка (верхняя платформа)
2 опоры для OMNI колеса
5 стоек по 60 мм
4 стойки по 130 мм
После резки обработайте края наждачкой, чтобы избежать заусенцев.  

Шаг 2: 3D-печать
Загрузите DXF-файлы в станок 3D-печати.  
Основные детали:  
2 колеса
Стойки для моторчиков
![image](https://github.com/user-attachments/assets/6dffb7dc-7430-4fb7-bbe7-f751f1ad7de7)
![image](https://github.com/user-attachments/assets/e265e2c7-af5c-46d4-87a9-87122f94bcaa)

Шаг 3: Сборка каркаса (первый слой)
Установка мотор редукторов
На валы мотор-редукторов установите колёса, закрепите их стопорными винтами.
![image](https://github.com/user-attachments/assets/9f04b441-88c4-4640-9b63-5f7a0e0fc872)

Найдите на нижней платформе посадочные места под моторы.
Зафиксируйте каждый мотор винтами M3 х 50 мм (4 шт) и гаек М3 (4 шт) с помощью напечатанных стоек (обратите внимание на то, чтобы провода от энкодеров были выведены к центру платформы)
Убедитесь, что при вращении колёса не задевают за край платформы и установлены ровно.
Уделите внимание ровной установке колес, это обеспечит качественное движение без лишних корректировок.
![image](https://github.com/user-attachments/assets/dd758873-1871-4d8a-adda-b4ce5c991556)
![image](https://github.com/user-attachments/assets/e09da91f-3ad2-423f-b8ae-80c137f1c8ae)

Установка OMNI колеса 
Найдите на нижней платформе посадочные места под вырезанные опоры OMNI колеса.
Установите их с помощью винтов М3 х 20 (4 шт) и гаек М3 (4 шт)
![image](https://github.com/user-attachments/assets/01de58ea-3ed2-43d3-945e-6c7934180a54)
![image](https://github.com/user-attachments/assets/226cf342-804d-4183-8706-759e79d707e0)

В отверстие опоры вставьте винт М3 х 50, немного накрутите на него гайку М3
![image](https://github.com/user-attachments/assets/57e0ae9f-9023-42b4-9d1f-cbbb0eee13f3)

Установите OMNI колесо на винт и закрутите (с внутренней стороны колеса) гайками М3 (2шт)
![image](https://github.com/user-attachments/assets/dcc521c2-1069-4f9c-9af2-20bf28b7fd74)
![image](https://github.com/user-attachments/assets/5e42c6bb-d48d-4c51-aebf-f17f88c949b8)

С внешней стороны опоры OMNI колеса зафиксируйте винт гайкой М3
Убедитесь, что при вращении колёсо не задевает за край платформы.
Установка драйвера моторов
Найдите в центре нижней платформы посадочные места под драйвер
Установите драйвер с помощью винтов М3 (2шт) и гаек М3 (2шт)

Шаг 4: Сборка каркаса (средний слой)
Пайка шилда для ESP
Шилд – плата с контактными площадками.   
Установите на ESP штыревые гнезда, затем вставьте конструкцию в печатную плату (со стороны пайки)
Установите штыревые штекеры в средних с конструкцией линиях на плате
Аккуратно переверните плату, поддерживая все компоненты
Включите паяльник и дождитесь, пока инструмент разогреется до 300-350°C. 
Нанесите припой на крайние контакты (используйте флюс для лучшего растекания припоя)
Необходимо спаять все крайние контакты попарно (контакт гнезда с контактом штекера)
Проведите аналогичную работу со всеми оставшимися контактами (ВАЖНО: два спаянных контакты не должны быть соединены с соседними
После окончания пайки необходимо провести проверку: 
1. Визуальный осмотр:  
   - Нет ли перемычек между контактами (проверка на отсутствие короткого замыкания)
 Все ли дорожки пропаяны (особенно у штыревых разъёмов).  
2.  Тест мультиметром:  
   - Прозвоните линии 5V и 3.3V на КЗ.  
   - Проверьте контакты GPIO на обрыв.  
Установка шилда на платформу
Найдите на средней платформе посадочное место для шилда
Вставьте снизу в платформу винты М2 (4шт) и накрутите на них гайки М2 (4шт). Данная конструкция не позволит передать находящиеся под шилдом провода  
Установите на винты собранный шилд и закрепите его сверху гайками М2 (4шт)
Установка блока питания 
Найдите на средней платформе посадочное место для блока питания (средняя часть платформы) 
Закрепите блок с помощью винтов М3 (2 шт) и гаек М3 (2шт)  (ВАЖНО: провода должны выходить в центральную часть платформы)
Монтаж: 
Схема соединений:
Пайка проводов
- Залудите контакты перед пайкой, а затем работайте по тому же принципу, как и при пайке шилда  
После окончания пайки необходимо провести проверку (визуальный осмотр и тест мультиметром) (ВАЖНО: проверьте, нет ли пережатых проводов)

Шаг 3: Подсоединение нижней и верхней платформы:
Соберите стойки из фанеры: 5 штук по 60 мм, 4 штуки по 130 мм (для этого понадобятся гайки М3 18 шт)
Соедините нижнюю и верхнюю платформы с помощью стоек по 60 мм, винтов М3 (10шт)

Шаг 5: Тестовый запуск
Подключите питание. 
Проверьте работу моторов, питание и загрузку ESP.

Модуль II - программироварние ESP32

После того как вся аппаратная часть собрана, можно переходить и к программной.
Все действия лучше делать на ноутбуке - так как это будет быстрее и надежней, хотя в теории можете и сделать все тоже самое на raspberry.
Начнем с программирования "нижнего уровня", тоесть esp32. Программировать будем через arduino IDE (если она еще у вас не установлена, то можете скачать с официального сайта https://www.arduino.cc/en/software ).
Чтоб можно было прошивать нашe платe добавим ее в список доступных для прошивки. Нужно зайти в файл->настройки и в поле "Дополнительные менеджеры плат" вставляем ссылку: https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json и нажимаем "ОК". 
После заходим в инструменты->плата->менеджер плат тут в строке поиска вводим esp32, выбираем соответсвующий вариант снизу и нажимаем на кнопку установить. 
После всех этих процедур для прошивки станут доступны платы семейства  ESP32.  Чтоб выбрать нужную плату заходим в инструменты->esp32 и выбираем нужную плату (мы использовали "ESP32 dev Module"). Также необходимо подключить саму плату к компьютеру и выбрать порт к которому она подключена заходим опять в инструменты->порт и выбираем нужный порт.
Помимо этого необходимо установить библиотеку для адресной светодиодной ленты. Для этого заходим в скетч->подключить библиотеку->Управлять библиотеками в поле поиска вводим "neopixel" и выбираем Adafruit neopixel и нажимаем установить.


Шаг 1. Настройка моторов

Здесь нам нужно понять как подключены моторы и сделать так, чтоб робот ехал вперед, когда мы действительно этого хотим.

-проверить направление вращения моторов
-проверить подключение энкодеров

Скачиваем или копируем код для esp32 из папки low_level "test_move_esp32", открфываем этот код в arduino ide и нажимаем в правом верхнем углу "загрузить".

После полной загрузки кода колеса робота должны вращаться вперед, если это не так, то следует поменять в коде местами номера пинов, к которым подключён драйвер моторов левой или право стороны.
Для определения вращения энкодеров открываем в arduino IDE serial port и следим за значениями: оба значения на левом и правом моторах должны возрастать, если это не так, то меняем местами пины энкодера в программе.
